<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: NewRelic::Control</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">NewRelic::Control</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/control_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/control.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Control.html">Control</a> is a singleton responsible for the
startup and initialization sequence. The initializer uses a <a
href="LocalEnvironment.html">LocalEnvironment</a> to detect the <a
href="Control.html#M000862">framework</a> and instantiates the <a
href="Control.html#M000862">framework</a> specific subclass.
</p>
<p>
The <a href="Control.html">Control</a> also implements some of the public
API for the agent.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000851">[]</a>&nbsp;&nbsp;
      <a href="#M000853">[]=</a>&nbsp;&nbsp;
      <a href="#M000860">agent_enabled?</a>&nbsp;&nbsp;
      <a href="#M000869">api_server</a>&nbsp;&nbsp;
      <a href="#M000861">app</a>&nbsp;&nbsp;
      <a href="#M000865">app_names</a>&nbsp;&nbsp;
      <a href="#M000855">append_environment_info</a>&nbsp;&nbsp;
      <a href="#M000879">append_environment_info</a>&nbsp;&nbsp;
      <a href="#M000857">capture_params</a>&nbsp;&nbsp;
      <a href="#M000884">config_file</a>&nbsp;&nbsp;
      <a href="#M000880">convert_to_ip_address</a>&nbsp;&nbsp;
      <a href="#M000859">developer_mode?</a>&nbsp;&nbsp;
      <a href="#M000864">dispatcher</a>&nbsp;&nbsp;
      <a href="#M000863">dispatcher_instance_id</a>&nbsp;&nbsp;
      <a href="#M000854">fetch</a>&nbsp;&nbsp;
      <a href="#M000862">framework</a>&nbsp;&nbsp;
      <a href="#M000872">http_connection</a>&nbsp;&nbsp;
      <a href="#M000849">init_plugin</a>&nbsp;&nbsp;
      <a href="#M000877">install_instrumentation</a>&nbsp;&nbsp;
      <a href="#M000876">install_shim</a>&nbsp;&nbsp;
      <a href="#M000848">instance</a>&nbsp;&nbsp;
      <a href="#M000856">license_key</a>&nbsp;&nbsp;
      <a href="#M000878">load_samplers</a>&nbsp;&nbsp;
      <a href="#M000874">log</a>&nbsp;&nbsp;
      <a href="#M000875">log!</a>&nbsp;&nbsp;
      <a href="#M000885">log_path</a>&nbsp;&nbsp;
      <a href="#M000881">merge_defaults</a>&nbsp;&nbsp;
      <a href="#M000858">monitor_mode?</a>&nbsp;&nbsp;
      <a href="#M000887">new</a>&nbsp;&nbsp;
      <a href="#M000886">new_instance</a>&nbsp;&nbsp;
      <a href="#M000888">newrelic_root</a>&nbsp;&nbsp;
      <a href="#M000889">newrelic_root</a>&nbsp;&nbsp;
      <a href="#M000870">proxy_server</a>&nbsp;&nbsp;
      <a href="#M000868">server</a>&nbsp;&nbsp;
      <a href="#M000871">server_from_host</a>&nbsp;&nbsp;
      <a href="#M000852">settings</a>&nbsp;&nbsp;
      <a href="#M000882">setup_log</a>&nbsp;&nbsp;
      <a href="#M000850">start_agent</a>&nbsp;&nbsp;
      <a href="#M000873">to_s</a>&nbsp;&nbsp;
      <a href="#M000883">to_stdout</a>&nbsp;&nbsp;
      <a href="#M000866">use_ssl?</a>&nbsp;&nbsp;
      <a href="#M000867">verify_certificate?</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">env</td>
          <td class="context-item-value">&nbsp;[W]&nbsp;</td>
          <td class="context-item-desc">
The env is the setting used to identify which section of the newrelic.yml
to load. This defaults to a <a href="Control.html#M000862">framework</a>
specific value, such as ENV[&#8216;RAILS_ENV&#8217;] but can be overridden
as long as you set it before calling <a
href="Control.html#M000849">init_plugin</a>

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">local_env</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">log_file</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000848" class="method-detail">
        <a name="M000848"></a>

        <div class="method-heading">
          <a href="#M000848" class="method-signature">
          <span class="method-name">instance</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Access the <a href="Control.html">Control</a> singleton, lazy initialized
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000848-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000848-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 36</span>
36:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>
37:       <span class="ruby-ivar">@instance</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">new_instance</span>
38:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000887" class="method-detail">
        <a name="M000887"></a>

        <div class="method-heading">
          <a href="#M000887" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(local_env)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000887-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000887-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 401</span>
401:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">local_env</span>
402:       <span class="ruby-ivar">@local_env</span> = <span class="ruby-identifier">local_env</span>
403:       <span class="ruby-identifier">newrelic_file</span> = <span class="ruby-identifier">config_file</span>
404:       <span class="ruby-comment cmt"># Next two are for populating the newrelic.yml via erb binding, necessary</span>
405:       <span class="ruby-comment cmt"># when using the default newrelic.yml file</span>
406:       <span class="ruby-identifier">generated_for_user</span> = <span class="ruby-value str">''</span>
407:       <span class="ruby-identifier">license_key</span>=<span class="ruby-value str">''</span>
408:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">config_file</span>)
409:         <span class="ruby-identifier">log!</span> <span class="ruby-node">&quot;Cannot find newrelic.yml file at #{config_file}.&quot;</span>
410:         <span class="ruby-ivar">@yaml</span> = {}
411:       <span class="ruby-keyword kw">else</span>
412:         <span class="ruby-ivar">@yaml</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load</span>(<span class="ruby-constant">ERB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">config_file</span>)).<span class="ruby-identifier">result</span>(<span class="ruby-identifier">binding</span>))
413:       <span class="ruby-keyword kw">end</span>
414:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ScriptError</span>, <span class="ruby-constant">StandardError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
415:       <span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>
416:       <span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
417:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error reading newrelic.yml file: #{e}&quot;</span>
418:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Class methods</h3>

      <div id="method-M000886" class="method-detail">
        <a name="M000886"></a>

        <div class="method-heading">
          <a href="#M000886" class="method-signature">
          <span class="method-name">new_instance</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create the concrete class for environment specific behavior:
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000886-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000886-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 381</span>
381:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_instance</span>
382:       <span class="ruby-ivar">@local_env</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">LocalEnvironment</span>.<span class="ruby-identifier">new</span>
383:       <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">framework</span>
384:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:test</span>
385:         <span class="ruby-identifier">require</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">newrelic_root</span>, <span class="ruby-value str">&quot;test&quot;</span>, <span class="ruby-value str">&quot;config&quot;</span>, <span class="ruby-value str">&quot;test_control.rb&quot;</span>)
386:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@local_env</span>
387:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:merb</span>
388:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'new_relic/control/merb'</span>
389:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Merb</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@local_env</span>
390:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:rails</span>
391:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'new_relic/control/rails'</span>
392:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Rails</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@local_env</span>
393:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:ruby</span>
394:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'new_relic/control/ruby'</span>
395:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Ruby</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@local_env</span>
396:       <span class="ruby-keyword kw">else</span> 
397:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown framework: #{@local_env.framework}&quot;</span>
398:       <span class="ruby-keyword kw">end</span>
399:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000888" class="method-detail">
        <a name="M000888"></a>

        <div class="method-heading">
          <a href="#M000888" class="method-signature">
          <span class="method-name">newrelic_root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The root directory for the plugin or gem
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000888-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000888-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 421</span>
421:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">newrelic_root</span>
422:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>),<span class="ruby-value str">&quot;..&quot;</span>,<span class="ruby-value str">&quot;..&quot;</span>))
423:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000851" class="method-detail">
        <a name="M000851"></a>

        <div class="method-heading">
          <a href="#M000851" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000851-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000851-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 96</span>
96:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
97:       <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>)
98:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000853" class="method-detail">
        <a name="M000853"></a>

        <div class="method-heading">
          <a href="#M000853" class="method-signature">
          <span class="method-name">[]=</span><span class="method-args">(key, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000853-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000853-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 110</span>
110:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
111:       <span class="ruby-identifier">settings</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
112:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000860" class="method-detail">
        <a name="M000860"></a>

        <div class="method-heading">
          <a href="#M000860" class="method-signature">
          <span class="method-name">agent_enabled?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if dev mode or monitor mode are enabled, and we are running inside a
valid <a href="Control.html#M000864">dispatcher</a> like mongrel or
passenger. Can be overridden by NEWRELIC_ENABLE env variable,
monitor_daemons config option when true, or agent_enabled config option
when true or false.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000860-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000860-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 145</span>
145:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_enabled?</span>
146:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">developer_mode?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">monitor_mode?</span>
147:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'agent_enabled'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true|on|yes/i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'agent_enabled'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'agent_enabled'</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">'auto'</span>
148:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NEWRELIC_ENABLE'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/false|off|no/i</span> 
149:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'monitor_daemons'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true|on|yes/i</span>
150:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NEWRELIC_ENABLE'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true|on|yes/i</span>
151:       <span class="ruby-comment cmt"># When in 'auto' mode the agent is enabled if there is a known</span>
152:       <span class="ruby-comment cmt"># dispatcher running</span>
153:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
154:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000869" class="method-detail">
        <a name="M000869"></a>

        <div class="method-heading">
          <a href="#M000869" class="method-signature">
          <span class="method-name">api_server</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000869-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000869-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 184</span>
184:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">api_server</span>
185:       <span class="ruby-identifier">api_host</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'api_host'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'rpm.newrelic.com'</span> 
186:       <span class="ruby-ivar">@api_server</span> <span class="ruby-operator">||=</span> 
187:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Server</span>.<span class="ruby-identifier">new</span> \
188:           <span class="ruby-identifier">api_host</span>, 
189:           (<span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'api_port'</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'port'</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">use_ssl?</span> <span class="ruby-value">? </span><span class="ruby-value">443</span> <span class="ruby-operator">:</span> <span class="ruby-value">80</span>)).<span class="ruby-identifier">to_i</span>, 
190:           <span class="ruby-keyword kw">nil</span>
191:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000861" class="method-detail">
        <a name="M000861"></a>

        <div class="method-heading">
          <a href="#M000861" class="method-signature">
          <span class="method-name">app</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000861-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000861-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">app</span>
157:       <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">framework</span>
158:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000865" class="method-detail">
        <a name="M000865"></a>

        <div class="method-heading">
          <a href="#M000865" class="method-signature">
          <span class="method-name">app_names</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000865-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000865-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 167</span>
167:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">app_names</span>
168:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'app_name'</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'app_name'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">';'</span>) <span class="ruby-operator">:</span> []
169:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000855" class="method-detail">
        <a name="M000855"></a>

        <div class="method-heading">
          <a href="#M000855" class="method-signature">
          <span class="method-name">append_environment_info</span><span class="method-args">(name, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add your own environment value to track for change detection. The name and
value should be stable and not vary across <a
href="Control.html#M000861">app</a> processes on the same host.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000855-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000855-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 120</span>
120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_environment_info</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
121:       <span class="ruby-identifier">local_env</span>.<span class="ruby-identifier">record_environment_info</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">value</span>)
122:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000857" class="method-detail">
        <a name="M000857"></a>

        <div class="method-heading">
          <a href="#M000857" class="method-signature">
          <span class="method-name">capture_params</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000857-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000857-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 130</span>
130:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">capture_params</span>
131:       <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'capture_params'</span>)
132:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000859" class="method-detail">
        <a name="M000859"></a>

        <div class="method-heading">
          <a href="#M000859" class="method-signature">
          <span class="method-name">developer_mode?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if we are capturing data and displaying in /newrelic
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000859-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000859-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">developer_mode?</span>
139:       <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'developer'</span>, <span class="ruby-keyword kw">nil</span>)
140:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000864" class="method-detail">
        <a name="M000864"></a>

        <div class="method-heading">
          <a href="#M000864" class="method-signature">
          <span class="method-name">dispatcher</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000864-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000864-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 164</span>
164:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dispatcher</span>
165:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'dispatcher'</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher</span>
166:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000863" class="method-detail">
        <a name="M000863"></a>

        <div class="method-heading">
          <a href="#M000863" class="method-signature">
          <span class="method-name">dispatcher_instance_id</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000863-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000863-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 161</span>
161:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dispatcher_instance_id</span>
162:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'dispatcher_instance_id'</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span>
163:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000854" class="method-detail">
        <a name="M000854"></a>

        <div class="method-heading">
          <a href="#M000854" class="method-signature">
          <span class="method-name">fetch</span><span class="method-args">(key, default=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000854-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000854-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 114</span>
114:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>=<span class="ruby-keyword kw">nil</span>)
115:       <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>)
116:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000862" class="method-detail">
        <a name="M000862"></a>

        <div class="method-heading">
          <span class="method-name">framework</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Control.html#M000861">app</a>
</p>
        </div>
      </div>

      <div id="method-M000872" class="method-detail">
        <a name="M000872"></a>

        <div class="method-heading">
          <a href="#M000872" class="method-signature">
          <span class="method-name">http_connection</span><span class="method-args">(host = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return the Net::HTTP with proxy configuration given the <a
href="../Server.html">NewRelic::Control::Server</a> object. Default is the
collector but for api calls you need to pass <a
href="Control.html#M000869">api_server</a>
</p>
<p>
Experimental support for SSL verification: swap &#8216;VERIFY_NONE&#8217;
for &#8216;VERIFY_PEER&#8217; line to try it out If verification fails,
uncomment the &#8216;http.ca_file&#8217; line and it will use the included
certificate.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000872-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000872-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 212</span>
212:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">http_connection</span>(<span class="ruby-identifier">host</span> = <span class="ruby-keyword kw">nil</span>)
213:       <span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">server</span>
214:       <span class="ruby-comment cmt"># Proxy returns regular HTTP if @proxy_host is nil (the default)</span>
215:       <span class="ruby-identifier">http_class</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Proxy</span>(<span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">port</span>, 
216:                                     <span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">user</span>, <span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">password</span>)
217:       <span class="ruby-identifier">http</span> = <span class="ruby-identifier">http_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">host</span>.<span class="ruby-identifier">ip</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">host</span>.<span class="ruby-identifier">port</span>)
218:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">use_ssl?</span>
219:         <span class="ruby-identifier">http</span>.<span class="ruby-identifier">use_ssl</span> = <span class="ruby-keyword kw">true</span>
220:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">verify_certificate?</span>
221:           <span class="ruby-identifier">http</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_PEER</span>
222:           <span class="ruby-identifier">http</span>.<span class="ruby-identifier">ca_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>), <span class="ruby-value str">'..'</span>, <span class="ruby-value str">'..'</span>, <span class="ruby-value str">'cert'</span>, <span class="ruby-value str">'cacert.pem'</span>)
223:         <span class="ruby-keyword kw">else</span>
224:           <span class="ruby-identifier">http</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span>
225:         <span class="ruby-keyword kw">end</span>
226:       <span class="ruby-keyword kw">end</span>
227:       <span class="ruby-identifier">http</span>
228:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000849" class="method-detail">
        <a name="M000849"></a>

        <div class="method-heading">
          <a href="#M000849" class="method-signature">
          <span class="method-name">init_plugin</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initialize the plugin/gem and start the agent. This does the necessary
configuration based on the <a href="Control.html#M000862">framework</a>
environment and determines whether or not to start the agent. If the agent
is not going to be started then it loads the agent shim which has stubs for
all the external api.
</p>
<p>
This may be invoked multiple times, as long as you don&#8216;t attempt to
uninstall the agent after it has been started.
</p>
<p>
If the plugin is initialized and it determines that the agent is not
enabled, it will skip starting it and install the shim. But if you later
call this with <tt>:agent_enabled =&gt; true</tt>, then it will install the
real agent and start it.
</p>
<p>
What determines whether the agent is launched is the result of calling <a
href="Control.html#M000860">agent_enabled?</a> This will indicate whether
the instrumentation should/will be installed. If we&#8216;re in a mode
where tracers are not installed then we should not start the agent.
</p>
<p>
Subclasses are not allowed to override, but must implement init_config({})
which is called at most once.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000849-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000849-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 59</span>
59:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_plugin</span>(<span class="ruby-identifier">options</span>={})
60:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'new_relic/agent'</span>
61:       <span class="ruby-comment cmt"># Merge the stringified options into the config as overrides:</span>
62:       <span class="ruby-identifier">logger_override</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:log</span>)
63:       <span class="ruby-identifier">environment_name</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:env</span>)
64:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">env</span> = <span class="ruby-identifier">environment_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">environment_name</span>
65:       <span class="ruby-comment cmt"># Clear out the settings, if they've already been loaded.  It may be that</span>
66:       <span class="ruby-comment cmt"># between calling init_plugin the first time and the second time, the env</span>
67:       <span class="ruby-comment cmt"># has been overridden</span>
68:       <span class="ruby-ivar">@settings</span> = <span class="ruby-keyword kw">nil</span>
69:       
70:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">val</span> <span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">sym</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">val</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:config</span> }
71:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger_override</span>
72:         <span class="ruby-ivar">@log</span> = <span class="ruby-identifier">logger_override</span>
73:         <span class="ruby-comment cmt"># Try to grab the log filename</span>
74:         <span class="ruby-ivar">@log_file</span> = <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-ivar">@logdev</span>.<span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span> }
75:       <span class="ruby-keyword kw">end</span>
76:       <span class="ruby-identifier">init_config</span>(<span class="ruby-identifier">options</span>)
77:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent_enabled?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@started</span>
78:         <span class="ruby-identifier">setup_log</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">logger_override</span>
79:         <span class="ruby-identifier">start_agent</span>
80:         <span class="ruby-identifier">install_instrumentation</span>
81:         <span class="ruby-identifier">load_samplers</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'disable_samplers'</span>]
82:         <span class="ruby-identifier">local_env</span>.<span class="ruby-identifier">gather_environment_info</span>
83:         <span class="ruby-identifier">append_environment_info</span>
84:         <span class="ruby-ivar">@started</span> = <span class="ruby-keyword kw">true</span>
85:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">agent_enabled?</span>
86:         <span class="ruby-identifier">install_shim</span>
87:       <span class="ruby-keyword kw">end</span>
88:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000877" class="method-detail">
        <a name="M000877"></a>

        <div class="method-heading">
          <a href="#M000877" class="method-signature">
          <span class="method-name">install_instrumentation</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000877-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000877-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 262</span>
262:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_instrumentation</span>
263:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@instrumented</span>
264:       
265:       <span class="ruby-ivar">@instrumented</span> = <span class="ruby-keyword kw">true</span>
266:       
267:       <span class="ruby-constant">Module</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">MethodTracer</span>
268:       
269:       <span class="ruby-comment cmt"># Instrumentation for the key code points inside rails for monitoring by NewRelic.</span>
270:       <span class="ruby-comment cmt"># note this file is loaded only if the newrelic agent is enabled (through config/newrelic.yml)</span>
271:       <span class="ruby-identifier">instrumentation_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>), <span class="ruby-value str">'agent'</span>,<span class="ruby-value str">'instrumentation'</span>)
272:       <span class="ruby-identifier">instrumentation_files</span> = [ ] <span class="ruby-operator">&lt;&lt;</span>
273:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">instrumentation_path</span>, <span class="ruby-value str">'*.rb'</span>) <span class="ruby-operator">&lt;&lt;</span>
274:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">instrumentation_path</span>, <span class="ruby-identifier">app</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-value str">'*.rb'</span>)
275:       <span class="ruby-identifier">instrumentation_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">pattern</span> <span class="ruby-operator">|</span>
276:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">pattern</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
277:           <span class="ruby-keyword kw">begin</span>
278:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Processing instrumentation file '#{file}'&quot;</span>
279:             <span class="ruby-identifier">require</span> <span class="ruby-identifier">file</span>
280:           <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
281:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error loading instrumentation file '#{file}': #{e}&quot;</span>
282:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
283:           <span class="ruby-keyword kw">end</span>
284:         <span class="ruby-keyword kw">end</span>
285:       <span class="ruby-keyword kw">end</span>
286:       
287:       <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Finished instrumentation&quot;</span>
288:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000876" class="method-detail">
        <a name="M000876"></a>

        <div class="method-heading">
          <a href="#M000876" class="method-signature">
          <span class="method-name">install_shim</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Install stubs to the proper location so the <a
href="Control.html#M000861">app</a> code will not fail if the agent is not
running.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000876-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000876-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 255</span>
255:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_shim</span>
256:       <span class="ruby-comment cmt"># Once we install instrumentation, you can't undo that by installing the shim.</span>
257:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Cannot install the Agent shim after instrumentation has already been installed!&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@instrumented</span>
258:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">ShimAgent</span>.<span class="ruby-identifier">instance</span>
259:       <span class="ruby-constant">Module</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">MethodTracerShim</span>
260:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000856" class="method-detail">
        <a name="M000856"></a>

        <div class="method-heading">
          <a href="#M000856" class="method-signature">
          <span class="method-name">license_key</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Agent.html">Agent</a> config conveniences
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000856-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000856-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 127</span>
127:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">license_key</span>
128:       <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'license_key'</span>)
129:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000878" class="method-detail">
        <a name="M000878"></a>

        <div class="method-heading">
          <a href="#M000878" class="method-signature">
          <span class="method-name">load_samplers</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000878-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000878-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 290</span>
290:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_samplers</span>
291:       <span class="ruby-identifier">agent</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>
292:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">add_sampler</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Samplers</span><span class="ruby-operator">::</span><span class="ruby-constant">MongrelSampler</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">local_env</span>.<span class="ruby-identifier">mongrel</span>
293:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">add_harvest_sampler</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Samplers</span><span class="ruby-operator">::</span><span class="ruby-constant">CpuSampler</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">Java</span>
294:       <span class="ruby-keyword kw">begin</span>
295:         <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">add_sampler</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Samplers</span><span class="ruby-operator">::</span><span class="ruby-constant">MemorySampler</span>.<span class="ruby-identifier">new</span>
296:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">RuntimeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
297:         <span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Cannot add memory sampling: #{e}&quot;</span>
298:       <span class="ruby-keyword kw">end</span>
299:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000874" class="method-detail">
        <a name="M000874"></a>

        <div class="method-heading">
          <a href="#M000874" class="method-signature">
          <span class="method-name">log</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000874-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000874-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 233</span>
233:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log</span>
234:       <span class="ruby-comment cmt"># If we try to get a log before one has been set up, return a stdout log</span>
235:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@log</span>
236:         <span class="ruby-identifier">l</span> = <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">STDOUT</span>)
237:         <span class="ruby-identifier">l</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span>
238:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">l</span>
239:       <span class="ruby-keyword kw">end</span>
240:       <span class="ruby-ivar">@log</span>
241:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000875" class="method-detail">
        <a name="M000875"></a>

        <div class="method-heading">
          <a href="#M000875" class="method-signature">
          <span class="method-name">log!</span><span class="method-args">(msg, level=:info)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
send the given message to STDOUT so that it shows up in the console. This
should be used for important informational messages at boot. The <a
href="Control.html#M000883">to_stdout</a> may be implemented differently by
different config subclasses. This will NOT print anything if tracers are
not enabled
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000875-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000875-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 247</span>
247:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log!</span>(<span class="ruby-identifier">msg</span>, <span class="ruby-identifier">level</span>=<span class="ruby-identifier">:info</span>)
248:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@settings</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">agent_enabled?</span>
249:       <span class="ruby-identifier">to_stdout</span> <span class="ruby-identifier">msg</span>
250:       <span class="ruby-identifier">log</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">level</span>, <span class="ruby-identifier">msg</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@log</span>
251:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000858" class="method-detail">
        <a name="M000858"></a>

        <div class="method-heading">
          <a href="#M000858" class="method-signature">
          <span class="method-name">monitor_mode?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if we are sending data to the <a
href="Control.html#M000868">server</a>, monitoring production
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000858-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000858-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 134</span>
134:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">monitor_mode?</span>
135:       <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'enabled'</span>, <span class="ruby-keyword kw">nil</span>)
136:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000870" class="method-detail">
        <a name="M000870"></a>

        <div class="method-heading">
          <a href="#M000870" class="method-signature">
          <span class="method-name">proxy_server</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000870-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000870-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 193</span>
193:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">proxy_server</span>
194:       <span class="ruby-ivar">@proxy_server</span> <span class="ruby-operator">||=</span>
195:          <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">ProxyServer</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_host'</span>], <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_port'</span>], <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_user'</span>], <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_pass'</span>] 
196:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000868" class="method-detail">
        <a name="M000868"></a>

        <div class="method-heading">
          <a href="#M000868" class="method-signature">
          <span class="method-name">server</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000868-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000868-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 180</span>
180:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">server</span>
181:       <span class="ruby-ivar">@remote_server</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">server_from_host</span>(<span class="ruby-keyword kw">nil</span>)  
182:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000871" class="method-detail">
        <a name="M000871"></a>

        <div class="method-heading">
          <a href="#M000871" class="method-signature">
          <span class="method-name">server_from_host</span><span class="method-args">(hostname=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000871-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000871-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 198</span>
198:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">server_from_host</span>(<span class="ruby-identifier">hostname</span>=<span class="ruby-keyword kw">nil</span>)
199:       <span class="ruby-identifier">host</span> = <span class="ruby-identifier">hostname</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'host'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'collector.newrelic.com'</span>
200:       
201:       <span class="ruby-comment cmt"># if the host is not an IP address, turn it into one</span>
202:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Server</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">host</span>, (<span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'port'</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">use_ssl?</span> <span class="ruby-value">? </span><span class="ruby-value">443</span> <span class="ruby-operator">:</span> <span class="ruby-value">80</span>)).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">convert_to_ip_address</span>(<span class="ruby-identifier">host</span>) 
203:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000852" class="method-detail">
        <a name="M000852"></a>

        <div class="method-heading">
          <a href="#M000852" class="method-signature">
          <span class="method-name">settings</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000852-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000852-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 100</span>
100:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">settings</span>
101:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@settings</span>
102:         <span class="ruby-ivar">@settings</span> = (<span class="ruby-ivar">@yaml</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">merge_defaults</span>(<span class="ruby-ivar">@yaml</span>[<span class="ruby-identifier">env</span>])) <span class="ruby-operator">||</span> {}
103:         <span class="ruby-comment cmt"># At the time we bind the settings, we also need to run this little piece</span>
104:         <span class="ruby-comment cmt"># of magic which allows someone to augment the id with the app name, necessary</span>
105:         <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;:#{app_names.first}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'multi_homed'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">app_names</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
106:       <span class="ruby-keyword kw">end</span>
107:       <span class="ruby-ivar">@settings</span>
108:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000850" class="method-detail">
        <a name="M000850"></a>

        <div class="method-heading">
          <a href="#M000850" class="method-signature">
          <span class="method-name">start_agent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Install the real agent into the <a href="Agent.html">Agent</a> module, and
issue the start command.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000850-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000850-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 91</span>
91:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_agent</span>
92:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>
93:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">start</span>
94:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000873" class="method-detail">
        <a name="M000873"></a>

        <div class="method-heading">
          <a href="#M000873" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000873-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000873-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
230:       <span class="ruby-node">&quot;Control[#{self.app}]&quot;</span>
231:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000866" class="method-detail">
        <a name="M000866"></a>

        <div class="method-heading">
          <a href="#M000866" class="method-signature">
          <span class="method-name">use_ssl?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000866-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000866-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 171</span>
171:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_ssl?</span>
172:       <span class="ruby-ivar">@use_ssl</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'ssl'</span>, <span class="ruby-keyword kw">false</span>)
173:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000867" class="method-detail">
        <a name="M000867"></a>

        <div class="method-heading">
          <a href="#M000867" class="method-signature">
          <span class="method-name">verify_certificate?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000867-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000867-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 175</span>
175:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verify_certificate?</span>
176:       <span class="ruby-comment cmt">#this can only be on when SSL is enabled</span>
177:       <span class="ruby-ivar">@verify_certificate</span> <span class="ruby-operator">||=</span> ( <span class="ruby-identifier">use_ssl?</span> <span class="ruby-value">? </span><span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'verify_certificate'</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>)
178:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000879" class="method-detail">
        <a name="M000879"></a>

        <div class="method-heading">
          <a href="#M000879" class="method-signature">
          <span class="method-name">append_environment_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Append <a href="Control.html#M000862">framework</a> specific environment
information for uploading to the <a href="Control.html#M000868">server</a>
for change detection. Override in subclasses
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000879-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000879-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 305</span>
305:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_environment_info</span>; <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000884" class="method-detail">
        <a name="M000884"></a>

        <div class="method-heading">
          <a href="#M000884" class="method-signature">
          <span class="method-name">config_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000884-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000884-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 368</span>
368:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">config_file</span>
369:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">&quot;config&quot;</span>,<span class="ruby-value str">&quot;newrelic.yml&quot;</span>))
370:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000880" class="method-detail">
        <a name="M000880"></a>

        <div class="method-heading">
          <a href="#M000880" class="method-signature">
          <span class="method-name">convert_to_ip_address</span><span class="method-args">(host)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Look up the ip address of the host using the pure ruby lookup to prevent
blocking. If that fails, fall back to the regular IPSocket library. Return
nil if we can&#8216;t find the host ip address and don&#8216;t have a good
default.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000880-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000880-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 311</span>
311:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_to_ip_address</span>(<span class="ruby-identifier">host</span>)
312:       <span class="ruby-comment cmt"># here we leave it as a host name since the cert verification</span>
313:       <span class="ruby-comment cmt"># needs it in host form</span>
314:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">host</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">verify_certificate?</span>
315:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;localhost&quot;</span>
316:       <span class="ruby-comment cmt"># Fall back to known ip address in the common case</span>
317:       <span class="ruby-identifier">ip_address</span> = <span class="ruby-value str">'65.74.177.195'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'collector.newrelic.com'</span>
318:       <span class="ruby-keyword kw">begin</span>
319:         <span class="ruby-identifier">ip_address</span> = <span class="ruby-constant">Resolv</span>.<span class="ruby-identifier">getaddress</span>(<span class="ruby-identifier">host</span>)
320:         <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Resolved #{host} to #{ip_address}&quot;</span>
321:       <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
322:         <span class="ruby-identifier">log</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;DNS Error caching IP address: #{e}&quot;</span>
323:         <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n   &quot;</span>)
324:         <span class="ruby-identifier">ip_address</span> = <span class="ruby-constant">IPSocket</span><span class="ruby-operator">::</span><span class="ruby-identifier">getaddress</span> <span class="ruby-identifier">host</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">ip_address</span>
325:       <span class="ruby-keyword kw">end</span>
326:       <span class="ruby-identifier">ip_address</span>
327:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000885" class="method-detail">
        <a name="M000885"></a>

        <div class="method-heading">
          <a href="#M000885" class="method-signature">
          <span class="method-name">log_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000885-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000885-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 372</span>
372:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_path</span>
373:       <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">'log'</span>)
374:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">path</span>
375:         <span class="ruby-identifier">path</span> = <span class="ruby-value str">'.'</span>
376:       <span class="ruby-keyword kw">end</span>
377:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
378:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000881" class="method-detail">
        <a name="M000881"></a>

        <div class="method-heading">
          <a href="#M000881" class="method-signature">
          <span class="method-name">merge_defaults</span><span class="method-args">(settings_hash)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000881-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000881-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 329</span>
329:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">merge_defaults</span>(<span class="ruby-identifier">settings_hash</span>)
330:       <span class="ruby-identifier">s</span> = {
331:         <span class="ruby-value str">'host'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'collector.newrelic.com'</span>,
332:         <span class="ruby-value str">'ssl'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
333:         <span class="ruby-value str">'log_level'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'info'</span>,
334:         <span class="ruby-value str">'apdex_t'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1.0</span>
335:       }
336:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">settings_hash</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">settings_hash</span>
337:       <span class="ruby-comment cmt"># monitor_daemons replaced with agent_enabled</span>
338:       <span class="ruby-identifier">s</span>[<span class="ruby-value str">'agent_enabled'</span>] = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'monitor_daemons'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span>[<span class="ruby-value str">'agent_enabled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'monitor_daemons'</span>)
339:       <span class="ruby-identifier">s</span>
340:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000889" class="method-detail">
        <a name="M000889"></a>

        <div class="method-heading">
          <a href="#M000889" class="method-signature">
          <span class="method-name">newrelic_root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000889-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000889-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 424</span>
424:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">newrelic_root</span>
425:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">newrelic_root</span>
426:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000882" class="method-detail">
        <a name="M000882"></a>

        <div class="method-heading">
          <a href="#M000882" class="method-signature">
          <span class="method-name">setup_log</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Control.html">Control</a> subclasses may override this, but it can
be called multiple times.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000882-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000882-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_log</span>
343:       <span class="ruby-ivar">@log_file</span> = <span class="ruby-node">&quot;#{log_path}/newrelic_agent.log&quot;</span>
344:       <span class="ruby-ivar">@log</span> = <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@log_file</span>
345:       
346:       <span class="ruby-comment cmt"># change the format just for our logger</span>
347:       
348:       <span class="ruby-keyword kw">def</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">format_message</span>(<span class="ruby-identifier">severity</span>, <span class="ruby-identifier">timestamp</span>, <span class="ruby-identifier">progname</span>, <span class="ruby-identifier">msg</span>)
349:         <span class="ruby-node">&quot;[#{timestamp.strftime(&quot;%m/%d/%y %H:%M:%S %z&quot;)} #{Socket.gethostname} (#{$$})] #{severity} : #{msg}\n&quot;</span> 
350:       <span class="ruby-keyword kw">end</span>
351:     
352:       <span class="ruby-comment cmt"># set the log level as specified in the config file</span>
353:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">&quot;log_level&quot;</span>,<span class="ruby-value str">&quot;info&quot;</span>).<span class="ruby-identifier">downcase</span>
354:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;debug&quot;</span>; <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">DEBUG</span>
355:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;info&quot;</span>; <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span>
356:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;warn&quot;</span>; <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">WARN</span>
357:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;error&quot;</span>; <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">ERROR</span>
358:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;fatal&quot;</span>; <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">FATAL</span>
359:       <span class="ruby-keyword kw">else</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span>
360:       <span class="ruby-keyword kw">end</span>
361:       <span class="ruby-ivar">@log</span>
362:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000883" class="method-detail">
        <a name="M000883"></a>

        <div class="method-heading">
          <a href="#M000883" class="method-signature">
          <span class="method-name">to_stdout</span><span class="method-args">(msg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000883-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000883-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/control.rb, line 364</span>
364:     <span class="ruby-keyword kw">def</span>  <span class="ruby-identifier">to_stdout</span><span class="ruby-identifier">to_stdout</span>(<span class="ruby-identifier">msg</span>)
365:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;** [NewRelic] &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">msg</span> 
366:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>