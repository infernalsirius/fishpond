<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: NewRelic::Agent::TransationSamplerTest</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">NewRelic::Agent::TransationSamplerTest</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test_rb.html">
                vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="../../Test/Unit/TestCase.html">
                Test::Unit::TestCase
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000524">setup</a>&nbsp;&nbsp;
      <a href="#M000536">test_big_sql</a>&nbsp;&nbsp;
      <a href="#M000531">test_double_scope_stack_empty</a>&nbsp;&nbsp;
      <a href="#M000527">test_harvest_slowest</a>&nbsp;&nbsp;
      <a href="#M000525">test_multiple_samples</a>&nbsp;&nbsp;
      <a href="#M000529">test_multithread</a>&nbsp;&nbsp;
      <a href="#M000535">test_nil_stacktrace</a>&nbsp;&nbsp;
      <a href="#M000538">test_param_capture</a>&nbsp;&nbsp;
      <a href="#M000528">test_preare_to_send</a>&nbsp;&nbsp;
      <a href="#M000532">test_record_sql_off</a>&nbsp;&nbsp;
      <a href="#M000526">test_sample_id</a>&nbsp;&nbsp;
      <a href="#M000530">test_sample_with_parallel_paths</a>&nbsp;&nbsp;
      <a href="#M000537">test_segment_obfuscated</a>&nbsp;&nbsp;
      <a href="#M000539">test_sql_normalization</a>&nbsp;&nbsp;
      <a href="#M000541">test_sql_normalization__double_quotes</a>&nbsp;&nbsp;
      <a href="#M000540">test_sql_normalization__single_quotes</a>&nbsp;&nbsp;
      <a href="#M000542">test_sql_obfuscation_filters</a>&nbsp;&nbsp;
      <a href="#M000534">test_stack_trace__scope</a>&nbsp;&nbsp;
      <a href="#M000533">test_stack_trace__sql</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000524" class="method-detail">
        <a name="M000524"></a>

        <div class="method-heading">
          <a href="#M000524" class="method-signature">
          <span class="method-name">setup</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000524-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000524-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 8</span>
 8:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
 9:     <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">current</span>[<span class="ruby-identifier">:record_sql</span>] = <span class="ruby-keyword kw">nil</span>
10:     <span class="ruby-identifier">mock_agent</span> = <span class="ruby-identifier">mock</span>()
11:     <span class="ruby-identifier">stats_engine_mock</span> = <span class="ruby-identifier">mock</span>()
12:     <span class="ruby-identifier">stats_engine_mock</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:add_scope_stack_listener</span>)
13:     <span class="ruby-identifier">mock_agent</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:stats_engine</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-identifier">stats_engine_mock</span>)
14:     <span class="ruby-identifier">mock_agent</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:set_sql_obfuscator</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-identifier">stats_engine_mock</span>)
15:     <span class="ruby-ivar">@sampler</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSampler</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">mock_agent</span>)
16:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000536" class="method-detail">
        <a name="M000536"></a>

        <div class="method-heading">
          <a href="#M000536" class="method-signature">
          <span class="method-name">test_big_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000536-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000536-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 173</span>
173:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_big_sql</span>
174:     
175:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
176:     
177:     <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;SADJKHASDHASD KAJSDH ASKDH ASKDHASDK JASHD KASJDH ASKDJHSAKDJHAS DKJHSADKJSAH DKJASHD SAKJDH SAKDJHS&quot;</span>
178:     
179:     <span class="ruby-identifier">len</span> = <span class="ruby-value">0</span>
180:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">len</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSampler</span><span class="ruby-operator">::</span><span class="ruby-constant">MAX_SQL_LENGTH</span>
181:       <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_sql</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)
182:       <span class="ruby-identifier">len</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">length</span>
183:     <span class="ruby-keyword kw">end</span>
184:     
185:     <span class="ruby-identifier">segment</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">current_segment</span>
186:     
187:     <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:sql</span>]
188:     
189:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSampler</span><span class="ruby-operator">::</span><span class="ruby-constant">MAX_SQL_LENGTH</span>
190:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000531" class="method-detail">
        <a name="M000531"></a>

        <div class="method-heading">
          <a href="#M000531" class="method-signature">
          <span class="method-name">test_double_scope_stack_empty</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000531-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000531-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 108</span>
108:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_double_scope_stack_empty</span>
109:     
110:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
111:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_transaction</span> <span class="ruby-value str">&quot;/path&quot;</span>, <span class="ruby-keyword kw">nil</span>, {}
112:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_push_scope</span> <span class="ruby-value str">&quot;a&quot;</span>
113:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_pop_scope</span> <span class="ruby-value str">&quot;a&quot;</span>
114:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
115:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
116:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
117:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
118:     
119:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">harvest</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)[<span class="ruby-value">0</span>]
120:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000527" class="method-detail">
        <a name="M000527"></a>

        <div class="method-heading">
          <a href="#M000527" class="method-signature">
          <span class="method-name">test_harvest_slowest</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000527-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000527-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 37</span>
37:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_harvest_slowest</span>
38:     
39:     <span class="ruby-identifier">run_sample_trace</span>
40:     <span class="ruby-identifier">run_sample_trace</span>
41:     <span class="ruby-identifier">run_sample_trace</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span> }
42:     <span class="ruby-identifier">run_sample_trace</span>
43:     <span class="ruby-identifier">run_sample_trace</span>
44:     
45:     <span class="ruby-identifier">slowest</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">harvest</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)[<span class="ruby-value">0</span>]
46:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">slowest</span>.<span class="ruby-identifier">duration</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span>
47:     
48:     <span class="ruby-identifier">run_sample_trace</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.2</span> }
49:     <span class="ruby-identifier">not_as_slow</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">harvest</span>(<span class="ruby-identifier">slowest</span>, <span class="ruby-value">0</span>)[<span class="ruby-value">0</span>]
50:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">not_as_slow</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">slowest</span>
51:     
52:     <span class="ruby-identifier">run_sample_trace</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.6</span> }
53:     <span class="ruby-identifier">new_slowest</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">harvest</span>(<span class="ruby-identifier">slowest</span>, <span class="ruby-value">0</span>)[<span class="ruby-value">0</span>]
54:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_slowest</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">slowest</span>
55:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_slowest</span>.<span class="ruby-identifier">duration</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span><span class="ruby-value">.6</span>
56:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000525" class="method-detail">
        <a name="M000525"></a>

        <div class="method-heading">
          <a href="#M000525" class="method-signature">
          <span class="method-name">test_multiple_samples</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000525-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000525-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 18</span>
18:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_multiple_samples</span>
19:     
20:     <span class="ruby-identifier">run_sample_trace</span>
21:     <span class="ruby-identifier">run_sample_trace</span>
22:     <span class="ruby-identifier">run_sample_trace</span>
23:     <span class="ruby-identifier">run_sample_trace</span>
24:     
25:     <span class="ruby-identifier">samples</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">samples</span>
26:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">4</span>, <span class="ruby-identifier">samples</span>.<span class="ruby-identifier">length</span>
27:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;a&quot;</span>, <span class="ruby-identifier">samples</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">called_segments</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">metric_name</span>
28:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;a&quot;</span>, <span class="ruby-identifier">samples</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">called_segments</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">metric_name</span>
29:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000529" class="method-detail">
        <a name="M000529"></a>

        <div class="method-heading">
          <a href="#M000529" class="method-signature">
          <span class="method-name">test_multithread</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000529-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000529-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 70</span>
70:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_multithread</span>
71:     <span class="ruby-identifier">threads</span> = []
72:     
73:     <span class="ruby-value">20</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
74:       <span class="ruby-identifier">t</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@sampler</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">the_sampler</span><span class="ruby-operator">|</span>
75:         <span class="ruby-ivar">@sampler</span> = <span class="ruby-identifier">the_sampler</span>
76:         <span class="ruby-value">100</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
77:           <span class="ruby-identifier">run_sample_trace</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.01</span> }
78:         <span class="ruby-keyword kw">end</span>
79:       <span class="ruby-keyword kw">end</span>
80:       
81:       <span class="ruby-identifier">threads</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>
82:     <span class="ruby-keyword kw">end</span>
83:     <span class="ruby-identifier">threads</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">join</span> }
84:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000535" class="method-detail">
        <a name="M000535"></a>

        <div class="method-heading">
          <a href="#M000535" class="method-signature">
          <span class="method-name">test_nil_stacktrace</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000535-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000535-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 159</span>
159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nil_stacktrace</span>
160:     
161:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">stack_trace_threshold</span> = <span class="ruby-value">2</span>
162:     
163:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
164:     
165:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_sql</span>(<span class="ruby-value str">&quot;test&quot;</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>)
166:     
167:     <span class="ruby-identifier">segment</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">current_segment</span>
168:     
169:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:sql</span>]
170:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:backtrace</span>]
171:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000538" class="method-detail">
        <a name="M000538"></a>

        <div class="method-heading">
          <a href="#M000538" class="method-signature">
          <span class="method-name">test_param_capture</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000538-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000538-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 208</span>
208:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_param_capture</span>
209:     [<span class="ruby-keyword kw">true</span>, <span class="ruby-keyword kw">false</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">capture</span><span class="ruby-operator">|</span> 
210:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:capture_params</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-identifier">capture</span>)
211:       <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
212:       <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_transaction</span>(<span class="ruby-value str">'/path'</span>, <span class="ruby-keyword kw">nil</span>, {<span class="ruby-identifier">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'hi'</span>})
213:       <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
214:       
215:       <span class="ruby-identifier">tt</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">harvest</span>(<span class="ruby-keyword kw">nil</span>,<span class="ruby-value">0</span>)[<span class="ruby-value">0</span>]
216:       
217:       <span class="ruby-identifier">assert_equal</span> (<span class="ruby-identifier">capture</span>) <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">tt</span>.<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:request_params</span>].<span class="ruby-identifier">length</span>
218:     <span class="ruby-keyword kw">end</span>
219:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000528" class="method-detail">
        <a name="M000528"></a>

        <div class="method-heading">
          <a href="#M000528" class="method-signature">
          <span class="method-name">test_preare_to_send</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000528-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000528-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 59</span>
59:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_preare_to_send</span>
60:     
61:     <span class="ruby-identifier">run_sample_trace</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.2</span> }
62:     <span class="ruby-identifier">sample</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">harvest</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)[<span class="ruby-value">0</span>]
63:     
64:     <span class="ruby-identifier">ready_to_send</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">prepare_to_send</span>
65:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">duration</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">ready_to_send</span>.<span class="ruby-identifier">duration</span>
66:     
67:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">ready_to_send</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Time</span>)
68:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000532" class="method-detail">
        <a name="M000532"></a>

        <div class="method-heading">
          <a href="#M000532" class="method-signature">
          <span class="method-name">test_record_sql_off</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000532-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000532-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 123</span>
123:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_record_sql_off</span>
124:     
125:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
126:     
127:     <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">current</span>[<span class="ruby-identifier">:record_sql</span>] = <span class="ruby-keyword kw">false</span>
128:     
129:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_sql</span>(<span class="ruby-value str">&quot;test&quot;</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)
130:     
131:     <span class="ruby-identifier">segment</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">current_segment</span>
132:     
133:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:sql</span>]
134:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000526" class="method-detail">
        <a name="M000526"></a>

        <div class="method-heading">
          <a href="#M000526" class="method-signature">
          <span class="method-name">test_sample_id</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000526-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000526-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 31</span>
31:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sample_id</span> 
32:     <span class="ruby-identifier">run_sample_trace</span> <span class="ruby-keyword kw">do</span> 
33:       <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">current_sample_id</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>, <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">current_sample_id</span> 
34:     <span class="ruby-keyword kw">end</span>
35:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000530" class="method-detail">
        <a name="M000530"></a>

        <div class="method-heading">
          <a href="#M000530" class="method-signature">
          <span class="method-name">test_sample_with_parallel_paths</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000530-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000530-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 86</span>
 86:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sample_with_parallel_paths</span>
 87:     
 88:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">scope_depth</span>
 89:     
 90:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
 91:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_transaction</span> <span class="ruby-value str">&quot;/path&quot;</span>, <span class="ruby-keyword kw">nil</span>, {}
 92:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_push_scope</span> <span class="ruby-value str">&quot;a&quot;</span>
 93:     
 94:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">scope_depth</span> 
 95:     
 96:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_pop_scope</span> <span class="ruby-value str">&quot;a&quot;</span>
 97:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
 98:     
 99:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">scope_depth</span> 
100:     
101:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
102:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_transaction</span> <span class="ruby-value str">&quot;/path&quot;</span>, <span class="ruby-keyword kw">nil</span>, {}
103:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_push_scope</span> <span class="ruby-value str">&quot;a&quot;</span>
104:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_pop_scope</span> <span class="ruby-value str">&quot;a&quot;</span>
105:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_scope_empty</span>
106:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000537" class="method-detail">
        <a name="M000537"></a>

        <div class="method-heading">
          <a href="#M000537" class="method-signature">
          <span class="method-name">test_segment_obfuscated</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000537-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000537-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 193</span>
193:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_segment_obfuscated</span>
194:     
195:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
196:     
197:     <span class="ruby-identifier">orig_sql</span> = <span class="ruby-value str">&quot;SELECT * from Jim where id=66&quot;</span>
198:     
199:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_sql</span>(<span class="ruby-identifier">orig_sql</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)
200:     
201:     <span class="ruby-identifier">segment</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">current_segment</span>
202:     
203:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">orig_sql</span>, <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:sql</span>]
204:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;SELECT * from Jim where id=?&quot;</span>, <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">obfuscated_sql</span>
205:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000539" class="method-detail">
        <a name="M000539"></a>

        <div class="method-heading">
          <a href="#M000539" class="method-signature">
          <span class="method-name">test_sql_normalization</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000539-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000539-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 222</span>
222:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sql_normalization</span>
223:     
224:     <span class="ruby-comment cmt"># basic statement</span>
225:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT INTO X values(?,?, ? , ?)&quot;</span>, 
226:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;INSERT INTO X values('test',0, 1 , 2)&quot;</span>)
227:     
228:     <span class="ruby-comment cmt"># escaped literals</span>
229:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT INTO X values(?, ?,?, ? , ?)&quot;</span>, 
230:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;INSERT INTO X values('', 'jim''s ssn',0, 1 , 'jim''s son''s son')&quot;</span>)
231:     
232:     <span class="ruby-comment cmt"># multiple string literals             </span>
233:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT INTO X values(?,?,?, ? , ?)&quot;</span>, 
234:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;INSERT INTO X values('jim''s ssn','x',0, 1 , 2)&quot;</span>)
235:     
236:     <span class="ruby-comment cmt"># empty string literal</span>
237:     <span class="ruby-comment cmt"># NOTE: the empty string literal resolves to empty string, which for our purposes is acceptable</span>
238:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT INTO X values(?,?,?, ? , ?)&quot;</span>, 
239:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;INSERT INTO X values('','x',0, 1 , 2)&quot;</span>)
240:     
241:     <span class="ruby-comment cmt"># try a select statement             </span>
242:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;select * from table where name=? and ssn=?&quot;</span>,
243:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;select * from table where name='jim gochee' and ssn=0012211223&quot;</span>)
244:     
245:     <span class="ruby-comment cmt"># number literals embedded in sql - oh well</span>
246:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;select * from table_? where name=? and ssn=?&quot;</span>,
247:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;select * from table_007 where name='jim gochee' and ssn=0012211223&quot;</span>)
248:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000541" class="method-detail">
        <a name="M000541"></a>

        <div class="method-heading">
          <a href="#M000541" class="method-signature">
          <span class="method-name">test_sql_normalization__double_quotes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000541-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000541-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 263</span>
263:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sql_normalization__double_quotes</span>
264:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
265:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT &quot;this isn't a real value&quot; into table]</span>)
266:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
267:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT &quot;'&quot; into table]</span>)
268:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
269:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT &quot; \&quot; &quot; into table]</span>)
270:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
271:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT &quot; 'some text' &quot; into table]</span>)
272:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000540" class="method-detail">
        <a name="M000540"></a>

        <div class="method-heading">
          <a href="#M000540" class="method-signature">
          <span class="method-name">test_sql_normalization__single_quotes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000540-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000540-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sql_normalization__single_quotes</span>
251:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
252:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">&quot;INSERT 'this isn''t a real value' into table&quot;</span>)
253:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
254:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT '&quot;' into table]</span>)
255:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
256:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT ' &quot;some text&quot; \&quot; ' into table]</span>)
257: <span class="ruby-comment cmt">#    could not get this one licked.  no biggie    </span>
258: <span class="ruby-comment cmt">#    assert_equal &quot;INSERT ? into table&quot;,</span>
259: <span class="ruby-comment cmt">#    @sampler.default_sql_obfuscator(%q[INSERT '\'' into table])</span>
260:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;INSERT ? into table&quot;</span>,
261:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">default_sql_obfuscator</span>(<span class="ruby-value str">%q[INSERT ''' ' into table]</span>)
262:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000542" class="method-detail">
        <a name="M000542"></a>

        <div class="method-heading">
          <a href="#M000542" class="method-signature">
          <span class="method-name">test_sql_obfuscation_filters</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000542-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000542-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 273</span>
273:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sql_obfuscation_filters</span>
274:     <span class="ruby-identifier">orig</span> =  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">obfuscator</span>
275:     
276:     <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">:replace</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span>
277:       <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;1&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sql</span>
278:     <span class="ruby-keyword kw">end</span>
279:     
280:     <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;SELECT * FROM TABLE 123 'jim'&quot;</span>
281:     
282:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;1&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sql</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">obfuscator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sql</span>)
283:     
284:     <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">:before</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span>
285:       <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;2&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sql</span>
286:     <span class="ruby-keyword kw">end</span>
287:     
288:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;12&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sql</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">obfuscator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sql</span>)
289:     
290:     <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">:after</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span>
291:       <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">sql</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;3&quot;</span>
292:     <span class="ruby-keyword kw">end</span>
293:     
294:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;12&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;3&quot;</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">obfuscator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sql</span>)
295:     
296:     <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">:replace</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">orig</span>)
297:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000534" class="method-detail">
        <a name="M000534"></a>

        <div class="method-heading">
          <a href="#M000534" class="method-signature">
          <span class="method-name">test_stack_trace__scope</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000534-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000534-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_stack_trace__scope</span>
149:     
150:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">stack_trace_threshold</span> = <span class="ruby-value">0</span>
151:     <span class="ruby-identifier">t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
152:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">to_f</span>
153:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_push_scope</span> <span class="ruby-value str">'Bill'</span>, (<span class="ruby-identifier">t</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>.<span class="ruby-identifier">second</span>).<span class="ruby-identifier">to_f</span>
154:     
155:     <span class="ruby-identifier">segment</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">current_segment</span>
156:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:backtrace</span>]
157:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000533" class="method-detail">
        <a name="M000533"></a>

        <div class="method-heading">
          <a href="#M000533" class="method-signature">
          <span class="method-name">test_stack_trace__sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000533-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000533-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/test/new_relic/agent/transaction_sampler_test.rb, line 136</span>
136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_stack_trace__sql</span>
137:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">stack_trace_threshold</span> = <span class="ruby-value">0</span>
138:     
139:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_first_scope_push</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>
140:     
141:     <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">notice_sql</span>(<span class="ruby-value str">&quot;test&quot;</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>)
142:     
143:     <span class="ruby-identifier">segment</span> = <span class="ruby-ivar">@sampler</span>.<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">current_segment</span>
144:     
145:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:sql</span>]
146:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">segment</span>[<span class="ruby-identifier">:backtrace</span>]
147:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>