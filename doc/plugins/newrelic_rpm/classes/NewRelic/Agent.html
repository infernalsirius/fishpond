<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: NewRelic::Agent</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">NewRelic::Agent</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent/agent_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent/agent.rb
                </a>
        <br />
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent/error_collector_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent/error_collector.rb
                </a>
        <br />
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb
                </a>
        <br />
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent/stats_engine_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent/stats_engine.rb
                </a>
        <br />
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent/transaction_sampler_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent/transaction_sampler.rb
                </a>
        <br />
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent/worker_loop_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent/worker_loop.rb
                </a>
        <br />
                <a href="../../files/vendor/plugins/newrelic_rpm/lib/new_relic/agent_rb.html">
                vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Methods in the <a href="Agent.html">Agent</a> module are delegated to the
<a href="Agent.html">NewRelic::Agent::Agent</a> singleton <a
href="Agent.html#M000070">instance</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000078">add_custom_parameters</a>&nbsp;&nbsp;
      <a href="#M000079">add_request_parameters</a>&nbsp;&nbsp;
      <a href="#M000068">agent</a>&nbsp;&nbsp;
      <a href="#M000069">agent=</a>&nbsp;&nbsp;
      <a href="#M000075">disable_sql_recording</a>&nbsp;&nbsp;
      <a href="#M000076">disable_transaction_tracing</a>&nbsp;&nbsp;
      <a href="#M000071">get_stats</a>&nbsp;&nbsp;
      <a href="#M000072">get_stats_no_scope</a>&nbsp;&nbsp;
      <a href="#M000077">ignore_error_filter</a>&nbsp;&nbsp;
      <a href="#M000070">instance</a>&nbsp;&nbsp;
      <a href="#M000073">manual_start</a>&nbsp;&nbsp;
      <a href="#M000074">set_sql_obfuscator</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="Agent/CollectionHelper.html" class="link">NewRelic::Agent::CollectionHelper</a><br />
Module <a href="Agent/Instrumentation.html" class="link">NewRelic::Agent::Instrumentation</a><br />
Module <a href="Agent/MethodTracer.html" class="link">NewRelic::Agent::MethodTracer</a><br />
Module <a href="Agent/MethodTracerShim.html" class="link">NewRelic::Agent::MethodTracerShim</a><br />
Module <a href="Agent/Samplers.html" class="link">NewRelic::Agent::Samplers</a><br />
Class <a href="Agent/Agent.html" class="link">NewRelic::Agent::Agent</a><br />
Class <a href="Agent/BackgroundLoadingError.html" class="link">NewRelic::Agent::BackgroundLoadingError</a><br />
Class <a href="Agent/ErrorCollector.html" class="link">NewRelic::Agent::ErrorCollector</a><br />
Class <a href="Agent/ForceDisconnectException.html" class="link">NewRelic::Agent::ForceDisconnectException</a><br />
Class <a href="Agent/IgnoreSilentlyException.html" class="link">NewRelic::Agent::IgnoreSilentlyException</a><br />
Class <a href="Agent/LicenseException.html" class="link">NewRelic::Agent::LicenseException</a><br />
Class <a href="Agent/PostTooBigException.html" class="link">NewRelic::Agent::PostTooBigException</a><br />
Class <a href="Agent/Sampler.html" class="link">NewRelic::Agent::Sampler</a><br />
Class <a href="Agent/ServerError.html" class="link">NewRelic::Agent::ServerError</a><br />
Class <a href="Agent/ShimAgent.html" class="link">NewRelic::Agent::ShimAgent</a><br />
Class <a href="Agent/StatsEngine.html" class="link">NewRelic::Agent::StatsEngine</a><br />
Class <a href="Agent/TransactionSampleBuilder.html" class="link">NewRelic::Agent::TransactionSampleBuilder</a><br />
Class <a href="Agent/TransactionSampler.html" class="link">NewRelic::Agent::TransactionSampler</a><br />
Class <a href="Agent/WorkerLoop.html" class="link">NewRelic::Agent::WorkerLoop</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">add_custom_parameters</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add parameters to the current transaction trace
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 201</span>
201:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_custom_parameters</span>(<span class="ruby-identifier">params</span>)
202:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">add_custom_parameters</span>(<span class="ruby-identifier">params</span>)
203:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000079" class="method-detail">
        <a name="M000079"></a>

        <div class="method-heading">
          <span class="method-name">add_request_parameters</span><span class="method-args">(params)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Agent.html#M000078">add_custom_parameters</a>
</p>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">agent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The singleton <a href="Agent.html">Agent</a> <a
href="Agent.html#M000070">instance</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 96</span>
96:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent</span>
97:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Plugin not initialized!&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@@agent</span>.<span class="ruby-identifier">nil?</span>
98:       <span class="ruby-ivar">@@agent</span>
99:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">agent=</span><span class="method-args">(new_instance)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 101</span>
101:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent=</span> <span class="ruby-identifier">new_instance</span>
102:       <span class="ruby-ivar">@@agent</span> = <span class="ruby-identifier">new_instance</span>
103:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000075" class="method-detail">
        <a name="M000075"></a>

        <div class="method-heading">
          <a href="#M000075" class="method-signature">
          <span class="method-name">disable_sql_recording</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method sets the state of sql recording in the transaction sampler
feature. Within the given block, no sql will be recorded
</p>
<p>
usage:
</p>
<pre>
  NewRelic::Agent.disable_sql_recording do
    ...
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000075-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000075-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 171</span>
171:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disable_sql_recording</span>
172:       <span class="ruby-identifier">state</span> = <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_sql</span>(<span class="ruby-keyword kw">false</span>)
173:       <span class="ruby-keyword kw">begin</span>
174:         <span class="ruby-keyword kw">yield</span>
175:       <span class="ruby-keyword kw">ensure</span>
176:         <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_sql</span>(<span class="ruby-identifier">state</span>)
177:       <span class="ruby-keyword kw">end</span>
178:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000076" class="method-detail">
        <a name="M000076"></a>

        <div class="method-heading">
          <a href="#M000076" class="method-signature">
          <span class="method-name">disable_transaction_tracing</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method disables the recording of transaction traces in the given
block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000076-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000076-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 182</span>
182:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disable_transaction_tracing</span>
183:       <span class="ruby-identifier">state</span> = <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_tt</span>(<span class="ruby-keyword kw">false</span>)
184:       <span class="ruby-keyword kw">begin</span>
185:         <span class="ruby-keyword kw">yield</span>
186:       <span class="ruby-keyword kw">ensure</span>
187:         <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_tt</span>(<span class="ruby-identifier">state</span>)
188:       <span class="ruby-keyword kw">end</span>
189:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000071" class="method-detail">
        <a name="M000071"></a>

        <div class="method-heading">
          <a href="#M000071" class="method-signature">
          <span class="method-name">get_stats</span><span class="method-args">(metric_name, use_scope=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get or create a statistics gatherer that will aggregate numerical data
under a metric name.
</p>
<p>
<tt>metric_name</tt> should follow a slash separated path convention.
Application specific metrics should begin with &quot;Custom/&quot;.
</p>
<p>
Return a <a href="Stats.html">NewRelic::Stats</a> that accepts data via
calls to add_data_point(value).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000071-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000071-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 115</span>
115:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_stats</span>(<span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">use_scope</span>=<span class="ruby-keyword kw">false</span>)
116:       <span class="ruby-ivar">@@agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">get_stats</span>(<span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">use_scope</span>)
117:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000072" class="method-detail">
        <a name="M000072"></a>

        <div class="method-heading">
          <a href="#M000072" class="method-signature">
          <span class="method-name">get_stats_no_scope</span><span class="method-args">(metric_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000072-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000072-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 119</span>
119:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_stats_no_scope</span>(<span class="ruby-identifier">metric_name</span>)
120:       <span class="ruby-ivar">@@agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">get_stats_no_scope</span>(<span class="ruby-identifier">metric_name</span>)
121:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">ignore_error_filter</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method allows a filter to be applied to errors that RPM will track.
The block should return the exception to track (which could be different
from the original exception) or nil to ignore this exception
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 195</span>
195:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ignore_error_filter</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
196:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">error_collector</span>.<span class="ruby-identifier">ignore_error_filter</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
197:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <span class="method-name">instance</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Agent.html#M000068">agent</a>
</p>
        </div>
      </div>

      <div id="method-M000073" class="method-detail">
        <a name="M000073"></a>

        <div class="method-heading">
          <a href="#M000073" class="method-signature">
          <span class="method-name">manual_start</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call this to manually start the <a href="Agent.html">Agent</a> in
situations where the <a href="Agent.html">Agent</a> does not auto-start.
</p>
<p>
When the app environment loads, so does the <a href="Agent.html">Agent</a>.
However, the <a href="Agent.html">Agent</a> will only connect to RPM if a
web front-end is found. If you want to selectively monitor ruby processes
that don&#8216;t use web plugins, then call this method in your code and
the <a href="Agent.html">Agent</a> will fire up and start reporting to RPM.
</p>
<p>
Options are passed in as overrides for values in the newrelic.yml, such as
app_name. In addition, the option <tt>log</tt> will take a logger that will
be used instead of the standard file logger. The setting for the
newrelic.yml section to use (ie, RAILS_ENV) can be overridden with an :env
argument.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000073-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000073-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 137</span>
137:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">manual_start</span>(<span class="ruby-identifier">options</span>={})
138:       <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">options</span>
139:       <span class="ruby-comment cmt"># Ignore all args but hash options</span>
140:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">:agent_enabled</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> 
141:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">init_plugin</span> <span class="ruby-identifier">options</span>
142:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000074" class="method-detail">
        <a name="M000074"></a>

        <div class="method-heading">
          <a href="#M000074" class="method-signature">
          <span class="method-name">set_sql_obfuscator</span><span class="method-args">(type = :replace, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method sets the block sent to this method as a sql obfuscator. The
block will be called with a single String SQL statement to obfuscate. The
method must return the obfuscated String SQL. If chaining of obfuscators is
required, use type = :before or :after
</p>
<p>
type = :before, :replace, :after
</p>
<p>
Example:
</p>
<pre>
   NewRelic::Agent.set_sql_obfuscator(:replace) do |sql|
      my_obfuscator(sql)
   end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000074-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000074-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/newrelic_rpm/lib/new_relic/agent.rb, line 157</span>
157:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">type</span> = <span class="ruby-identifier">:replace</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
158:       <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span> <span class="ruby-identifier">type</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
159:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>